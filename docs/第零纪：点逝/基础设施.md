## 基础设施 v0.1（零依赖/标准库）

### 概述

- **目标**: 克隆仓库后即可运行与测试；无第三方依赖；结果可复现、可测试、可观测。
- **范围**: 本纪仅围绕第零纪「点逝」，不讨论后续纪。

### 语言与依赖

- **语言**: Python 3.8+
- **依赖策略（零依赖）**: 仅使用 Python 标准库，不引入任何第三方包（无需 `pip install`）。
- **常用标准库清单（示例）**: `time`, `json`, `os`, `pathlib`, `sys`, `signal`, `random`, `unittest`, `subprocess`, `tempfile`。

### 目录与规模约束

- **epoch0/**: 单文件实现（`dot.py`），总行数 ≤30（含空行与注释）；运行时生成 `dot.json`（状态文件）。
- **同目录原则**: `dot.json` 与 `dot.py` 同目录，避免不同工作目录产生多份状态。

### 状态与时序

- **主状态**: 整数 `tick` 单调不减。
- **派生值**: `dot = max(0, 1.0 - 0.01 * tick)`（打印两位小数）。
- **时序**: 1 Hz 循环（约每秒一 tick），接受轻微时钟漂移。

### 持久化与原子写

- **格式**: JSON（紧凑写法）。示例：`{"dot": 0.67, "tick": 33}`。
- **原子写**: 先写入 `*.tmp`，再以 `os.replace(tmp, path)` 原子替换，确保崩溃最多丢失当前 tick，不损坏文件。
- **异常策略**: 读取非法 JSON 时显式报错并退出（提示清理），不覆盖原文件。

### 日志/观测（NDJSON）

- **格式**: NDJSON（Newline-Delimited JSON），每行一条事件，顺序即时间序。
- **通用字段**: `t`（tick，整数），`ts`（Unix 秒），`evt`（事件类型）。
- **本纪事件类型**: `tick`, `death`。
- **字段约定**:
  - `tick` 事件包含 `dot` 字段：当前点值（两位小数展示用的派生量）。
  - `death` 事件包含 `reason` 字段：终止原因说明（例如 `dot<=0`）。
- **示例**:

```json
{"evt":"tick","t":12,"ts":1699999999,"dot":0.88}
{"evt":"death","t":100,"ts":1699999999,"reason":"dot<=0"}
```

### 随机性与可复现

- **默认**: 使用固定种子（如 42），保证测试与验收的可复现性。
- **环境变量**: `MLS_SEED`
  - 未设置 → 使用默认固定种子；
  - `MLS_SEED=rand` → 使用系统随机种子，并在首条日志记录实际种子；
  - `MLS_SEED=<int>` → 使用该整数作为种子。

### 测试与验收（TDD 导向）

- **单元测试**: 优先测试纯函数（若有），避免副作用；
- **端到端**: 固定随机种子运行；覆盖正常递减、续传、边界值、非法文件等验收场景；
- **不变式**: `tick` 单调不减；`dot≤0` 时立即终止并输出死亡事件/提示。

### CI/CD（可后置）

- **GitHub Actions**（建议）:
  - Python 版本矩阵：3.8~3.12；
  - 不执行依赖安装步骤；
  - 运行单测与端到端测试；
  - 可选：上传 NDJSON 日志为 build artifact 便于分析/回放。

### 变更指引

- 本纪内若需调整字段或事件类型，应保持向后兼容或在文档中明确列出变更与迁移步骤。
